{% extends 'basehome.html.twig' %}

{% block title %}Receta{% endblock %}

{% block body %}
<div class="container text-center">
    <div id="recuadro">
        <h1>Receta: {{ recetum.nombre }}</h1>

        <div id="receta-imagen" class="mb-4">
            {% if recetum.png %}
                <img src="{{ asset(recetum.png|slice(1)) }}" class="img-fluid mb-3">
            {% else %}
                <p>No hay imagen disponible</p>
            {% endif %}
        </div>

        <div class="tabla-detalles mx-auto" style="max-width: 800px;">
            <table class="table table-bordered text-center">
                <tbody>
                    <tr>
                        <th>Nombre</th>
                        <td>{{ recetum.nombre }}</td>
                    </tr>
                    <tr>
                        <th>Descripci칩n</th>
                        <td>{{ recetum.descripcion }}</td>
                    </tr>
                    <tr>
                        <th>Tiempo de preparaci칩n</th>
                        <td>{{ recetum.tiempoprep }} minutos</td>
                    </tr>
                    <tr>
                        <th>Porciones</th>
                        <td>{{ recetum.porciones }}</td>
                    </tr>
                    <tr>
                        <th>Dificultad</th>
                        <td>{{ recetum.dificultad }}</td>
                    </tr>
                    <tr>
                        <th>Pasos:</th>
                        <td>
                            {% if recetum.pasos is not empty %}
                                <ol class="pasos-receta">
                                    {% for paso in recetum.pasos %}
                                        <li><p>{{ paso.descripcion }}</p></li>
                                    {% endfor %}
                                </ol>
                            {% else %}
                                <p>No hay pasos disponibles</p>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <button onclick="window.history.back()" class="btn-back">Volver</button>

        {% if app.user %}
            <button id="fav-button" class="btn-favorite" onclick="toggleFavorite({{ recetum.id }})">
                {{ isFavorite ? 'Eliminar de favoritos' : 'A침adir a favoritos' }}
            </button>
        {% endif %}
    </div>
</div>

<script>
function toggleFavorite(recipeId) {
    fetch('', {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({ recetaId: recipeId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const button = document.getElementById('fav-button');
            button.textContent = data.action === 'added' ? 'Eliminar de favoritos' : 'A침adir a favoritos';
        } else {
            alert('Error al actualizar favoritos');
        }
    })
    .catch(error => console.error('Error:', error));
}
</script>
{% endblock %}
